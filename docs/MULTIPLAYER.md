# Руководство по мультиплееру

## Быстрый старт

### 1. Установка зависимостей

Для сервера (Python):
```bash
pip install -r requirements.txt
```

Для клиента (Node.js):
```bash
npm install
```

### 2. Настройка конфигурации

Скопируйте `.env.example` в `.env` и настройте параметры:

```bash
cp .env.example .env
```

Параметры в `.env`:
- `SERVER_HOST` - хост сервера (по умолчанию `localhost`)
- `SERVER_PORT` - порт WebSocket сервера (по умолчанию `8765`)
- `VITE_PORT` - порт веб-приложения (по умолчанию `3000`)
- `VITE_WS_URL` - URL WebSocket для клиента (по умолчанию `ws://localhost:8765`)

### 3. Запуск

#### Локальная игра (одна сеть WiFi)

1. Запустите сервер:
```bash
python server.py
```

2. Запустите клиент:
```bash
npm run dev
```

3. Откройте браузер на `http://localhost:3000`

#### Игра через интернет (ngrok)

1. Установите ngrok: https://ngrok.com/download

2. Запустите сервер:
```bash
python server.py
```

3. В другом терминале запустите ngrok:
```bash
ngrok tcp 8765
```

4. Скопируйте URL из ngrok (например: `tcp://0.tcp.ngrok.io:12345`)

5. Обновите `.env`:
```
VITE_WS_URL=ws://0.tcp.ngrok.io:12345
```

6. Запустите клиент:
```bash
npm run dev
```

7. Поделитесь URL с друзьями: `http://localhost:3000`

## Как играть

### Создание комнаты

1. Выберите "Мультиплеер" в главном меню
2. Нажмите "Создать комнату"
3. Введите ваше имя
4. Выберите режим игры
5. Нажмите "Создать"
6. Поделитесь кодом комнаты с друзьями (5 символов)

### Присоединение к комнате

1. Выберите "Мультиплеер" в главном меню
2. Нажмите "Присоединиться к комнате"
3. Введите ваше имя
4. Введите код комнаты
5. Нажмите "Войти"

### Начало игры

- Только хост может начать игру
- Минимум 2 игрока для старта
- Максимум 8 игроков в комнате

## Архитектура

### Сервер (Python + WebSockets)

Сервер управляет:
- Созданием и удалением комнат
- Подключением/отключением игроков
- Синхронизацией состояния игры
- Передачей ввода между клиентами

### Клиент (React + TypeScript)

Клиент отвечает за:
- Подключение к серверу
- Отображение лобби
- Рендеринг игры
- Отправку ввода

### Протокол

Сообщения WebSocket в формате JSON:

#### Создание комнаты
```json
{
  "type": "create_room",
  "player_id": "player_123",
  "name": "Player 1",
  "game_mode": "classic"
}
```

#### Присоединение к комнате
```json
{
  "type": "join_room",
  "room_code": "ABC12",
  "player_id": "player_456",
  "name": "Player 2"
}
```

#### Начало игры
```json
{
  "type": "start_game"
}
```

#### Синхронизация состояния (от хоста)
```json
{
  "type": "game_state",
  "state": {
    "players": [...],
    "foods": [...],
    "bullets": [...]
  }
}
```

#### Ввод игрока
```json
{
  "type": "player_input",
  "direction": { "x": 1, "y": 0 }
}
```

## Устранение неполадок

### Не удается подключиться к серверу

1. Проверьте, что сервер запущен: `python server.py`
2. Проверьте URL в настройках мультиплеера
3. Проверьте брандмауэр (порт 8765 должен быть открыт)

### Игра не начинается

1. Убедитесь, что минимум 2 игрока в лобби
2. Только хост может начать игру
3. Проверьте консоль браузера на ошибки

### Лаги в игре

1. Проверьте скорость интернета
2. Используйте локальную сеть для лучшей производительности
3. Уменьшите количество игроков

## Скрипты для запуска

В папке `scripts/` есть готовые скрипты:

- `START_LOCAL.bat` - локальный запуск (Windows)
- `START_PUBLIC.bat` - публичный запуск через ngrok (Windows)
- `START_PUBLIC_AUTO.bat` - автоматический публичный запуск (Windows)
- `START.sh` - универсальный скрипт (Linux/Mac)

## Безопасность

- Сервер не хранит персональные данные
- Комнаты автоматически удаляются при выходе всех игроков
- Коды комнат генерируются случайно
- Нет аутентификации (игра для друзей)

## Производительность

- Сервер поддерживает множество комнат одновременно
- Каждая комната изолирована
- Состояние игры синхронизируется 10 раз в секунду
- Оптимизировано для 2-8 игроков

## Будущие улучшения

- [ ] Чат в лобби
- [ ] Реконнект при разрыве соединения
- [ ] Статистика игр
- [ ] Рейтинговая система
- [ ] Наблюдатели (spectators)
- [ ] Запись и воспроизведение игр
