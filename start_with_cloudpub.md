# Запуск публичного сервера через CloudPub

## Что такое CloudPub?
CloudPub (https://cloudpub.ru/) - российский сервис для создания туннелей к локальным серверам.
Аналог ngrok, но с серверами в России.

## Шаг 1: Установка CloudPub

1. Перейдите на https://cloudpub.ru/
2. Скачайте клиент для Windows
3. Установите или распакуйте в удобное место
4. (Опционально) Зарегистрируйтесь для получения постоянного домена

## Шаг 2: Запуск серверов

### Вариант А: Автоматический запуск
Запустите файл `start_with_cloudpub.bat`

### Вариант Б: Ручной запуск

Откройте 3 окна PowerShell/CMD:

#### Окно 1 - WebSocket сервер
```powershell
python server.py
```
Сервер запустится на `ws://localhost:8765`

#### Окно 2 - HTTP сервер (для игры)
```powershell
python -m http.server 8000
```
Сервер запустится на `http://localhost:8000`

#### Окно 3 - CloudPub туннель для WebSocket
```powershell
cloudpub http 8765
```
CloudPub выдаст публичный URL, например: `https://abc123.cloudpub.ru`

## Шаг 3: Настройка игры

После запуска CloudPub вы получите URL типа: `https://abc123.cloudpub.ru`

### Вариант 1: Изменить код (для постоянного использования)
Откройте `index.html` и найдите строку:
```javascript
ws = new WebSocket('ws://localhost:8765');
```

Замените на:
```javascript
ws = new WebSocket('wss://abc123.cloudpub.ru'); // ваш URL от CloudPub
```

### Вариант 2: Использовать настройки в игре (уже реализовано)
В игре есть поле для ввода адреса сервера - просто введите туда ваш CloudPub URL.

## Шаг 4: Открытие игры

### Для локальной игры:
Откройте `http://localhost:8000/index.html`

### Для публичного доступа:
Создайте туннель и для HTTP сервера:
```powershell
cloudpub http 8000
```
Получите URL (например: `https://xyz789.cloudpub.ru`) и поделитесь им с друзьями.

## Важные замечания

1. **WebSocket через HTTPS**: CloudPub автоматически поддерживает WebSocket (ws://) через HTTPS туннель (wss://)

2. **Бесплатный план**: 
   - Случайный домен при каждом запуске
   - Ограничение по времени работы туннеля
   - Ограничение по трафику

3. **Платный план**:
   - Постоянный домен
   - Без ограничений по времени
   - Больше трафика

4. **Безопасность**: Не забывайте, что ваш сервер становится доступен из интернета!

## Пример полного запуска

```powershell
# Терминал 1
python server.py

# Терминал 2  
python -m http.server 8000

# Терминал 3
cloudpub http 8765
# Получаем: https://abc123.cloudpub.ru

# Терминал 4 (опционально, для публичного доступа к игре)
cloudpub http 8000
# Получаем: https://xyz789.cloudpub.ru
```

Теперь:
- Игроки подключаются к `https://xyz789.cloudpub.ru/index.html`
- WebSocket сервер доступен по `wss://abc123.cloudpub.ru`

## Альтернатива: Только WebSocket через CloudPub

Если вы хотите, чтобы игроки открывали игру локально (file:///), но подключались к вашему серверу:

1. Запустите только WebSocket сервер и туннель для него
2. Поделитесь файлом `index.html` с друзьями
3. В настройках игры укажите адрес вашего CloudPub туннеля

## Troubleshooting

**Проблема**: WebSocket не подключается
**Решение**: Убедитесь, что используете `wss://` (не `ws://`) для HTTPS туннелей

**Проблема**: Туннель закрывается
**Решение**: CloudPub может закрывать неактивные туннели. Перезапустите командой.

**Проблема**: Ошибка "Connection refused"
**Решение**: Убедитесь, что локальный сервер запущен перед созданием туннеля.
